from collections import deque

def add_edge(graph, u, v, bidirectional=True):
    if u not in graph:
        graph[u] = []
    if v not in graph:
        graph[v] = []
    
    graph[u].append(v)
    if bidirectional:
        graph[v].append(u)


def bfs_shortest_path(graph, start, goal):
    if start not in graph or goal not in graph:
        print("Start or goal node not in graph.")
        return None

    queue = deque()
    visited = set()
    parent = {}  # to reconstruct path

    queue.append(start)
    visited.add(start)
    parent[start] = None  # start has no parent

    while queue:
        current = queue.popleft()

        # Goal check
        if current == goal:
            # Reconstruct path from goal to start using parent dictionary
            path = []
            node = goal
            while node is not None:
                path.append(node)
                node = parent[node]
            path.reverse()
            return path
        
        for neighbor in graph[current]:
            if neighbor not in visited:
                visited.add(neighbor)
                parent[neighbor] = current
                queue.append(neighbor)



def main():
    print("=== Shortest Path Finder using BFS ===")
    graph = {}

    # Take graph input from user
    n_edges = int(input("Enter number of edges: ").strip())
    print("Enter edges in the format: u v")
    print("Example: A B  (meaning edge between A and B)")

    for _ in range(n_edges):
        u, v = input().split()
        add_edge(graph, u, v, bidirectional=True)

    print("\nGraph adjacency list:")
    for node, neighbors in graph.items():
        print(f"{node}: {neighbors}")

    start = input("\nEnter start node: ").strip()
    goal = input("Enter goal node: ").strip()

    path = bfs_shortest_path(graph, start, goal)

    if path is None:
        print(f"\nNo path found from {start} to {goal}.")
    else:
        print("\nShortest path found using BFS:")
        print(" -> ".join(path))
        print(f"Number of steps: {len(path) - 1}")


if __name__ == "__main__":
    main()
